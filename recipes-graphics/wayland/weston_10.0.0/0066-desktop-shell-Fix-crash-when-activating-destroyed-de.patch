From abd46dfd5e96945e5403a74dbc38371bde42db7e Mon Sep 17 00:00:00 2001
From: Jeffy Chen <jeffy.chen@rock-chips.com>
Date: Tue, 31 May 2022 12:32:18 +0800
Subject: [PATCH 66/67] desktop-shell: Fix crash when activating destroyed
 desktop surface

Tested with Qt's Windows Flags Example, by switching between Popup and
Tool repeatedly.

Signed-off-by: Jeffy Chen <jeffy.chen@rock-chips.com>
---
 desktop-shell/shell.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/desktop-shell/shell.c b/desktop-shell/shell.c
index bb5d028..3e3949c 100644
--- a/desktop-shell/shell.c
+++ b/desktop-shell/shell.c
@@ -3787,7 +3787,8 @@ activate(struct desktop_shell *shell, struct weston_view *view,
 
 	main_surface = weston_surface_get_main_surface(es);
 	shsurf = get_shell_surface(main_surface);
-	assert(shsurf);
+	if (!shsurf)
+		return;
 
 	shsurf_child = get_last_child(shsurf);
 	if (shsurf_child) {
-- 
2.20.1

